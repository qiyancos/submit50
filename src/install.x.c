#if 0
	shc Version 3.8.6, Generic Script Compiler
	Copyright (c) 1994-2006 Francisco Rosales <frosal@fi.upm.es>

	shc -r -f ./install 
#endif

static  char data [] = 
#define      msg2_z	19
#define      msg2	((&data[1]))
	"\201\345\202\201\131\165\357\354\112\162\303\252\230\053\173\065"
	"\112\064\232\045\146"
#define      rlax_z	1
#define      rlax	((&data[21]))
	"\277"
#define      pswd_z	256
#define      pswd	((&data[67]))
	"\100\324\347\320\114\267\006\155\202\046\070\062\227\166\361\240"
	"\333\376\016\357\242\140\052\043\306\326\170\173\340\053\251\041"
	"\000\221\361\114\111\370\272\314\036\363\377\266\151\300\224\322"
	"\155\323\044\202\062\163\127\053\063\136\054\161\255\274\346\140"
	"\154\156\277\131\040\132\140\207\167\067\020\304\370\244\227\145"
	"\170\273\350\252\056\077\326\142\235\003\323\113\277\271\254\053"
	"\050\154\205\111\306\346\320\075\035\340\002\025\204\231\173\374"
	"\124\143\247\203\242\175\345\100\200\270\214\100\162\070\154\233"
	"\244\361\344\153\327\264\250\365\225\253\013\031\105\206\026\232"
	"\351\275\035\214\073\002\315\273\273\131\374\056\222\150\311\067"
	"\131\256\242\061\142\113\047\367\366\062\021\073\271\047\325\243"
	"\345\362\060\040\365\375\334\261\127\330\340\351\100\252\040\232"
	"\130\303\314\273\016\363\263\004\046\304\100\337\354\025\203\322"
	"\010\263\362\376\261\316\260\010\247\221\362\347\073\023\202\224"
	"\326\116\117\344\101\003\351\147\307\051\107\264\077\313\206\110"
	"\177\171\106\060\110\367\071\357\210\054\327\303\077\131\127\026"
	"\247\247\373\350\252\344\120\162\016\230\047\116\144\256\226\343"
	"\047\335\024\157\324\116\137\135\172\066\040\271\217\170\317\066"
	"\040\313\037\313\257\160\075\276\011\145\014\156\023\360\126\105"
	"\357\145\065\221\306\140\264\215"
#define      shll_z	10
#define      shll	((&data[334]))
	"\004\120\172\274\232\116\313\240\240\166"
#define      msg1_z	42
#define      msg1	((&data[347]))
	"\067\131\103\355\047\275\252\177\052\373\033\201\267\345\372\347"
	"\372\340\351\064\016\234\335\272\014\035\101\061\232\041\325\153"
	"\164\123\062\310\136\273\051\163\342\262\154\147\005\051\246\214"
	"\041\140\131\077"
#define      inlo_z	3
#define      inlo	((&data[396]))
	"\043\172\160"
#define      opts_z	1
#define      opts	((&data[399]))
	"\134"
#define      date_z	8
#define      date	((time_t*)(&data[400]))
	"\101\137\035\000\203\301\266\253\071\311"
#define      tst1_z	22
#define      tst1	((&data[413]))
	"\007\317\253\155\056\156\247\061\020\032\375\130\334\316\037\375"
	"\212\114\133\214\000\306\211\275\214\017\346"
#define      xecc_z	15
#define      xecc	((&data[440]))
	"\136\005\107\203\320\273\010\152\331\065\322\012\001\243\325\267"
	"\072\352"
#define      lsto_z	1
#define      lsto	((&data[455]))
	"\216"
#define      chk1_z	22
#define      chk1	((&data[461]))
	"\271\104\236\167\215\316\074\255\165\316\230\116\141\341\155\320"
	"\001\106\005\176\225\317\167\352\310\164\107\353\173\305"
#define      text_z	806
#define      text	((&data[628]))
	"\027\116\016\036\036\271\056\004\276\360\043\034\365\152\041\210"
	"\323\206\163\174\100\267\032\267\105\006\063\013\244\347\232\274"
	"\066\250\333\124\142\012\130\040\372\173\075\360\346\137\170\271"
	"\345\354\065\046\244\120\336\351\127\021\364\373\371\217\270\057"
	"\067\224\203\232\236\334\273\231\130\371\211\077\130\002\371\076"
	"\356\057\144\222\177\102\173\326\123\160\322\114\377\213\174\067"
	"\037\377\321\275\334\215\126\064\206\340\163\336\342\155\034\320"
	"\234\201\143\033\303\337\362\027\117\305\144\116\120\340\205\157"
	"\340\127\055\274\344\204\361\152\144\145\111\106\322\145\330\243"
	"\370\050\011\367\220\147\023\310\124\345\362\030\164\274\315\164"
	"\022\126\047\207\334\253\045\206\353\040\362\337\307\255\275\311"
	"\303\071\271\300\373\240\021\332\112\114\054\362\063\103\162\224"
	"\071\362\130\257\213\167\077\323\145\034\347\035\035\270\132\270"
	"\312\272\275\226\003\107\346\354\215\372\063\312\333\344\161\024"
	"\264\145\212\350\061\245\144\010\073\121\125\110\240\321\136\365"
	"\332\103\311\220\372\112\213\055\147\311\330\017\171\303\171\353"
	"\011\204\001\007\221\355\365\120\327\174\012\114\023\015\132\334"
	"\047\171\032\373\170\304\012\257\177\351\150\053\035\032\212\027"
	"\160\133\240\016\040\147\222\075\304\174\326\045\167\176\364\166"
	"\025\362\213\242\376\056\263\324\025\040\023\263\252\122\271\352"
	"\105\035\257\173\134\312\226\206\172\312\370\346\114\002\305\226"
	"\033\100\214\226\331\152\043\222\251\106\173\327\017\053\012\337"
	"\100\020\102\113\316\006\303\257\013\263\255\164\362\220\331\271"
	"\012\334\110\360\040\072\111\111\255\205\246\344\251\205\023\216"
	"\245\073\333\233\130\127\225\304\352\226\356\343\157\341\271\276"
	"\055\247\240\050\136\007\003\051\005\273\230\264\371\065\040\000"
	"\311\157\335\047\251\377\025\216\113\214\326\313\260\123\347\366"
	"\017\326\343\267\020\314\111\145\311\007\303\312\017\030\247\050"
	"\304\066\117\015\021\342\031\005\105\355\035\320\001\070\113\022"
	"\271\270\232\041\137\335\212\342\366\251\102\021\025\006\014\370"
	"\243\366\145\165\204\064\312\314\245\264\231\032\060\355\027\327"
	"\151\005\356\302\147\264\152\131\177\265\110\036\145\313\063\111"
	"\172\260\157\306\301\316\273\153\047\102\331\166\230\076\170\073"
	"\361\151\007\166\152\070\130\001\324\376\017\005\222\074\302\230"
	"\275\371\164\037\156\023\150\027\015\022\040\367\277\155\030\226"
	"\163\366\047\204\260\145\107\272\164\155\120\212\001\155\001\257"
	"\207\250\333\261\175\014\066\067\130\354\344\003\230\266\066\155"
	"\115\320\203\123\015\175\270\061\020\366\251\005\110\232\347\367"
	"\072\115\075\162\010\050\000\146\016\011\226\007\036\103\150\021"
	"\266\323\177\013\002\000\163\005\326\376\206\022\153\115\104\144"
	"\023\007\131\214\065\076\033\213\213\273\327\307\204\052\152\105"
	"\215\273\373\062\177\240\153\262\134\133\170\200\141\321\260\365"
	"\372\363\070\316\222\072\162\203\351\017\033\274\003\242\316\173"
	"\040\317\031\070\222\313\321\264\001\216\310\332\351\363\331\107"
	"\265\141\143\126\007\300\301\005\330\034\032\145\213\067\127\156"
	"\224\106\215\034\011\277\322\103\352\216\050\202\237\337\274\311"
	"\134\220\033\174\105\252\175\231\155\345\156\137\166\063\031\204"
	"\332\107\232\344\324\005\040\200\163\021\030\351\275\015\155\141"
	"\213\272\325\256\173\357\013\335\340\347\254\036\225\376\027\100"
	"\157\035\153\215\140\120\032\072\007\055\361\152\367\100\146\202"
	"\073\346\015\231\114\306\030\255\030\303\276\005\005\116\152\076"
	"\055\063\163\167\172\363\127\102\177\173\051\156\143\122\164\016"
	"\231\151\115\012\030\177\331\157\007\225\140\110\363\206\137\236"
	"\311\226\035\055\120\110\337\023\366\115\110\202\023\065\025\104"
	"\127\164\136\261\122\152\226\375\054\032\127\355\036\322\345\236"
	"\013\006\215\044\075\112\270\262\315\267\114\264\213\144\000\022"
	"\371\017\263\116\243\225\155\170\037\147\370\076\355\152\121\022"
	"\000\365\043\231\275\270\010\241\005\342\131\230\006\036\031\010"
	"\260\177\027\270\315\157\332\335\222\250\177\304\342\237\205\131"
	"\253\134\364\136\027\156\347\172\212\252\131\175\302\251\102\046"
	"\367\222\007\175\002\350\324\057\244\270\264\226\043\030\374\154"
	"\137\317\322\166\075\271\361\310\144\113\105\046\364\210\115\353"
	"\032\125\151\035\075\075\115\341\366\001\170\031\031\164\206\170"
	"\103\130\357\201\022\340\112\166\054\217\235\040\027\352\014\062"
	"\077\165\117\175\262\235\136\251\236\327\303\267\114\111\060\220"
	"\242\037\021\264\000\133\052\054\353\307\115\003\262\131\065\362"
	"\316\205\157\201\042"
#define      tst2_z	19
#define      tst2	((&data[1547]))
	"\204\042\370\253\160\352\214\130\352\236\103\226\013\046\223\042"
	"\064\075\215\246\356\170"
#define      chk2_z	19
#define      chk2	((&data[1570]))
	"\202\261\107\020\072\304\245\174\052\073\227\236\310\065\237\111"
	"\213\114\363\260\332\311\224"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	0	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned)chkenv;
	mask ^= (unsigned)getpid() * ~mask;
	sprintf(buff, "x%x", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%u %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%u %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && date[0]<time(NULL))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		if (text_z < hide_z) {
			/* Prepend spaces til a hide_z script size. */
			scrpt = malloc(hide_z);
			if (!scrpt)
				return 0;
			memset(scrpt, (int) ' ', hide_z);
			memcpy(&scrpt[hide_z - text_z], text, text_z);
		} else {
			scrpt = text;	/* Script text */
		}
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, argv[0]);
		} else {
			scrpt = argv[0];
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
