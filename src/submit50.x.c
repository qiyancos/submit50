#if 0
	shc Version 3.8.9b, Generic Script Compiler
	Copyright (c) 1994-2015 Francisco Rosales <frosal@fi.upm.es>

	shc -r -T -f ./submit50 
#endif

static  char data [] = 
#define      msg1_z	42
#define      msg1	((&data[8]))
	"\200\056\102\223\111\162\321\136\137\221\233\146\227\045\002\052"
	"\345\164\247\117\304\120\005\303\353\033\124\245\214\141\330\237"
	"\253\071\207\110\035\233\234\367\067\072\137\036\145\007\161\027"
	"\056\341\361\232\236\003\304\077\041"
#define      date_z	1
#define      date	((&data[57]))
	"\346"
#define      tst1_z	22
#define      tst1	((&data[63]))
	"\015\154\362\004\063\372\256\371\325\335\060\370\052\143\035\013"
	"\067\323\337\176\170\374\035\014\043\305\016\320\330\117"
#define      msg2_z	19
#define      msg2	((&data[90]))
	"\317\320\340\335\105\135\056\366\370\021\375\112\257\061\215\042"
	"\166\115\246\334\171\143\030\102\065"
#define      lsto_z	1
#define      lsto	((&data[113]))
	"\274"
#define      shll_z	10
#define      shll	((&data[114]))
	"\170\145\077\004\136\263\261\355\320\135\125"
#define      xecc_z	15
#define      xecc	((&data[128]))
	"\201\101\133\374\173\146\216\117\050\203\201\245\117\263\322\337"
	"\023\274\013"
#define      inlo_z	3
#define      inlo	((&data[144]))
	"\161\202\006"
#define      chk1_z	22
#define      chk1	((&data[152]))
	"\053\112\157\271\032\263\060\203\135\251\202\102\056\133\007\061"
	"\302\030\054\365\126\175\345\060\212\364\302\076\211\175\127"
#define      opts_z	1
#define      opts	((&data[178]))
	"\114"
#define      pswd_z	256
#define      pswd	((&data[212]))
	"\070\025\071\221\330\240\022\031\373\035\150\303\033\273\277\351"
	"\347\011\130\240\044\226\051\242\355\366\124\273\366\326\240\057"
	"\354\111\022\303\347\032\151\252\137\356\273\311\104\027\242\072"
	"\306\223\030\063\176\203\115\202\300\011\365\216\376\201\302\350"
	"\313\324\254\262\357\025\135\116\003\030\027\107\060\272\202\366"
	"\115\233\052\314\036\167\116\337\201\104\155\200\305\060\150\220"
	"\004\024\103\363\051\240\102\054\271\131\164\351\024\366\340\141"
	"\221\012\055\260\202\173\217\003\277\375\204\205\055\354\026\062"
	"\000\132\046\052\372\150\126\263\302\312\235\326\301\176\067\123"
	"\210\145\003\013\341\223\017\241\220\223\046\276\177\075\360\200"
	"\227\027\252\222\177\001\106\101\313\343\030\215\141\120\340\352"
	"\265\343\365\226\166\004\067\007\227\136\305\027\234\266\227\063"
	"\315\102\306\115\103\014\216\017\357\247\234\121\367\174\073\254"
	"\140\061\103\327\066\172\336\315\331\244\345\165\132\175\251\050"
	"\277\157\165\002\174\004\021\153\253\255\275\242\052\371\117\212"
	"\053\222\141\141\015\100\057\346\344\024\134\077\221\006\147\120"
	"\165\335\123\361\341\145\135\215\023\033\057\075\024\177\310\100"
	"\021\052\241\036\152\320\005\117\345\142\216\166\150\366\307\336"
	"\324\332\301\305\172\323\336\165\361\107\071\014\003\370\366\352"
	"\002\116\212\046\345\264\310\322\252\035\216\241\364\057\320\341"
	"\011\221\246\203\145\205\370\127\314\062\144\320\052\132\272\054"
	"\250\105\123\216\371\033\141\243\071\357"
#define      rlax_z	1
#define      rlax	((&data[525]))
	"\255"
#define      text_z	1470
#define      text	((&data[547]))
	"\246\264\253\014\071\244\143\006\326\307\326\000\041\221\055\312"
	"\327\200\130\320\234\213\267\265\126\026\042\077\010\060\132\354"
	"\333\254\135\030\035\150\056\206\123\323\025\351\044\257\152\022"
	"\353\063\171\054\131\353\215\361\026\306\260\036\241\136\234\213"
	"\120\341\222\357\120\343\152\164\224\000\043\360\067\334\127\252"
	"\016\367\307\045\007\055\114\246\124\230\126\264\223\012\241\305"
	"\331\173\155\025\221\215\164\227\360\275\206\234\317\255\117\321"
	"\105\246\061\236\344\345\123\054\334\030\136\351\073\362\230\377"
	"\151\144\275\314\344\071\362\340\047\142\154\375\330\217\003\371"
	"\310\111\247\335\200\342\270\024\376\324\234\125\324\006\210\225"
	"\051\244\372\213\106\013\177\077\363\263\144\217\343\303\344\321"
	"\343\340\225\161\120\122\110\157\340\355\205\227\053\313\200\250"
	"\377\262\167\174\323\255\022\343\347\074\274\034\231\322\150\142"
	"\140\072\154\033\277\254\221\204\000\140\066\133\145\237\334\167"
	"\030\043\337\312\266\261\224\244\135\075\201\241\012\037\143\157"
	"\376\062\226\177\116\225\122\046\341\220\370\120\123\055\252\155"
	"\361\074\340\372\203\170\312\007\334\335\021\126\237\146\310\264"
	"\364\150\052\107\240\035\166\221\017\361\073\350\350\201\272\356"
	"\030\052\351\255\065\247\253\150\176\240\126\051\035\244\005\153"
	"\331\006\173\227\223\254\335\262\346\316\233\302\341\140\314\352"
	"\366\205\157\356\047\230\256\170\206\151\201\074\177\320\241\332"
	"\035\345\300\164\015\374\066\171\220\250\152\023\063\135\115\144"
	"\056\255\200\255\205\370\117\207\113\075\121\026\144\063\303\233"
	"\052\062\021\002\232\071\303\242\117\215\251\154\263\067\227\373"
	"\342\042\321\055\161\063\073\056\013\342\230\117\103\000\354\351"
	"\350\330\251\126\326\022\161\160\060\344\213\226\137\306\235\354"
	"\254\117\256\003\113\056\046\172\047\025\052\157\043\274\137\062"
	"\132\214\255\135\334\115\134\355\022\240\214\315\172\173\056\232"
	"\162\211\341\072\306\143\231\111\241\023\254\303\257\333\343\322"
	"\130\104\207\227\172\255\261\360\343\021\362\336\373\032\302\373"
	"\051\364\275\013\310\347\126\363\355\124\343\270\365\316\250\335"
	"\352\312\274\117\024\064\136\007\364\213\156\162\102\112\332\043"
	"\314\314\172\012\015\221\277\022\075\033\352\335\230\021\146\353"
	"\031\132\113\154\325\276\125\275\277\365\033\010\110\153\103\103"
	"\223\245\210\365\115\362\137\055\231\125\005\117\076\370\164\121"
	"\235\250\043\241\242\177\011\160\260\324\054\371\041\262\127\055"
	"\104\246\140\007\116\057\344\375\130\127\225\141\316\244\247\305"
	"\371\023\275\277\364\055\035\252\250\305\256\067\305\131\215\101"
	"\361\016\000\104\226\031\104\000\053\316\100\011\161\107\170\076"
	"\363\030\172\000\050\357\177\352\124\114\104\027\032\055\062\071"
	"\002\150\262\267\167\272\235\077\301\111\323\350\134\100\030\324"
	"\345\051\123\235\273\112\103\054\161\100\330\015\220\150\201\377"
	"\312\373\033\014\257\222\307\172\356\220\055\314\366\021\070\140"
	"\226\335\034\176\065\374\204\025\012\212\137\331\343\177\013\317"
	"\261\162\356\045\153\332\002\117\063\252\070\352\243\273\353\231"
	"\365\153\142\343\255\350\324\364\154\311\207\204\347\043\313\111"
	"\066\230\370\046\267\135\112\155\305\306\377\331\033\106\162\331"
	"\134\116\374\231\257\011\057\340\107\127\255\163\214\113\230\177"
	"\153\271\105\146\246\272\013\134\157\331\222\311\131\340\274\062"
	"\037\301\100\236\301\377\225\162\246\331\267\214\237\354\215\266"
	"\361\216\145\370\347\331\007\217\152\303\057\215\066\024\243\160"
	"\341\275\275\301\212\364\041\317\122\036\065\246\337\352\000\045"
	"\137\112\340\052\172\250\243\201\277\205\241\254\070\157\064\266"
	"\235\324\137\355\024\206\264\326\011\214\003\162\223\300\274\065"
	"\217\304\107\024\170\136\230\266\346\114\115\362\123\126\316\017"
	"\035\361\337\010\001\111\127\271\362\245\243\053\374\232\077\262"
	"\305\226\203\027\334\067\153\272\247\153\052\166\001\300\314\333"
	"\135\354\132\203\326\255\172\251\024\254\346\316\164\225\264\346"
	"\043\137\233\327\210\025\346\033\331\042\224\051\302\052\050\366"
	"\347\251\111\351\321\175\072\055\376\152\047\144\251\143\040\072"
	"\061\357\040\104\110\026\335\211\205\011\343\221\120\131\360\052"
	"\136\135\165\035\173\242\307\044\063\144\143\335\065\147\153\046"
	"\016\372\207\302\205\211\232\111\177\221\002\156\274\045\173\166"
	"\170\152\114\343\213\170\362\061\057\057\056\003\254\101\267\125"
	"\345\360\130\066\023\230\151\262\226\070\064\130\145\317\005\151"
	"\264\225\206\107\051\246\137\133\141\337\374\026\137\145\043\122"
	"\046\222\155\023\305\036\346\143\202\224\063\207\347\004\014\377"
	"\017\137\060\367\162\216\264\152\375\015\367\125\123\335\055\372"
	"\212\243\245\212\017\033\337\072\036\107\065\215\115\363\126\367"
	"\033\057\071\271\145\323\173\271\367\305\324\042\351\255\045\036"
	"\272\245\035\126\045\334\040\273\012\270\305\210\333\277\153\237"
	"\356\332\101\121\266\164\260\343\207\261\261\356\035\105\234\202"
	"\110\024\030\142\242\031\237\206\141\365\062\140\260\122\345\372"
	"\257\101\315\041\007\016\011\365\216\127\201\322\051\322\013\361"
	"\043\270\056\063\210\231\346\160\254\072\236\122\150\235\012\232"
	"\046\233\116\335\262\133\251\265\105\062\366\010\077\375\253\135"
	"\360\022\101\156\122\375\300\116\165\301\261\300\115\056\250\007"
	"\315\324\152\244\103\353\233\010\366\170\107\141\314\311\030\142"
	"\175\220\341\102\222\066\323\136\202\147\121\014\226\101\207\074"
	"\104\037\136\301\014\341\050\376\374\103\005\101\070\174\200\362"
	"\242\301\076\163\253\044\317\321\025\365\216\041\154\303\202\155"
	"\160\261\132\233\247\313\343\262\270\277\112\357\073\276\370\222"
	"\135\200\175\272\353\236\200\374\113\362\247\240\311\021\135\267"
	"\141\025\146\251\376\013\027\273\171\363\047\063\232\317\177\156"
	"\024\247\253\326\173\025\336\371\314\103\327\133\243\314\311\004"
	"\213\273\171\043\001\214\364\353\374\350\076\334\030\156\006\070"
	"\162\063\067\260\000\276\000\053\056\364\220\045\361\141\332\260"
	"\035\305\371\167\253\072\221\334\301\126\076\134\143\242\263\226"
	"\203\013\245\222\166\244\372\277\001\231\306\232\145\206\105\243"
	"\035\347\301\335\026\027\032\144\321\104\055\134\304\250\314\056"
	"\217\171\154\262\276\034\046\355\161\105\113\062\117\166\005\046"
	"\113\216\226\060\157\335\033\025\172\324\150\364\275\322\377\055"
	"\234\104\070\132\120\310\324\272\305\330\335\112\006\244\304\316"
	"\062\263\262\271\164\325\251\271\003\310\316\022\360\165\307\234"
	"\201\000\100\345\007\026\254\336\027\316\160\104\231\107\305\362"
	"\027\141\254\214\067\125\105\072\036\024\114\017\212\023\253\014"
	"\024\353\361\034\002\236\372\032\155\152\137\006"
#define      tst2_z	19
#define      tst2	((&data[2074]))
	"\266\110\163\063\072\276\313\301\172\000\145\072\146\261\260\246"
	"\314\310\321\312\206\244\126"
#define      chk2_z	19
#define      chk2	((&data[2101]))
	"\370\031\261\105\043\102\370\002\272\021\100\142\333\117\232\120"
	"\203\161\150\176\260\175\320\050\073\131"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask  = (unsigned long)&chkenv;
	mask ^= (unsigned long)getpid() * ~mask;
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

#if !defined(TRACEABLE)

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !defined(TRACEABLE) */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];

	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	ret = chkenv(argc);
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
	varg[j++] = argv[0];		/* My own name at execution */
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
